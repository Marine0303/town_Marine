<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>WOS 固定マップ（実座標・アイソメ）</title>
<style>
  html,body{margin:0;height:100%;background:#050b1a;color:#e9eefc;font-family:system-ui;overflow:hidden}
  header{
    position:fixed;left:0;right:0;top:0;z-index:10;
    display:flex;gap:8px;align-items:center;flex-wrap:wrap;
    padding:10px;background:rgba(10,16,40,.92);border-bottom:1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(8px);
  }
  button{background:#0f1b44;color:#e9eefc;border:1px solid rgba(255,255,255,.18);
    border-radius:10px;padding:8px 10px;font-size:14px;cursor:pointer}
  .pill{padding:6px 10px;border:1px solid rgba(255,255,255,.18);border-radius:999px;background:#0b1433}
  #c{position:fixed;inset:52px 0 0 0;touch-action:none;}
</style>
</head>
<body>
<header>
  <span class="pill">WOS 固定マップ（A）</span>
  <button id="reset">表示リセット</button>
</header>

<canvas id="c"></canvas>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  // ====== 表示設定 ======
  const SCALE = 0.8;           // 見た目倍率（好みで調整）
  const TILE_W = 40;           // タイル幅
  const TILE_H = 20;           // タイル高
  const BASE = {x:0,y:0};      // 画面中央に合わせる

  // カメラ（パン＆ズーム）
  const cam = { x:0, y:0, s:1 };

  // ====== 実座標 固定施設（A 完成版） ======
  const FIXED = [
    // 太陽城
    { type:"sun", x:597, y:597, label:"SUN" },

    // 要塞（4）
    { type:"fortress", x:597, y:800, label:"要塞1" },
    { type:"fortress", x:400, y:597, label:"要塞2" },
    { type:"fortress", x:597, y:400, label:"要塞3" },
    { type:"fortress", x:800, y:597, label:"要塞4" },

    // 砦（12）
    { type:"fort", x:237, y:828 },
    { type:"fort", x:237, y:606 },
    { type:"fort", x:237, y:348 },

    { type:"fort", x:366, y:237 },
    { type:"fort", x:588, y:137 },
    { type:"fort", x:846, y:237 },

    { type:"fort", x:957, y:348 },
    { type:"fort", x:957, y:606 },
    { type:"fort", x:957, y:828 },

    { type:"fort", x:846, y:957 },
    { type:"fort", x:606, y:957 },
    { type:"fort", x:306, y:957 },
  ];

  // ====== 実座標 → 画面（アイソメ変換） ======
  function iso(x,y){
    return {
      sx:(x-y)*SCALE,
      sy:(x+y)*SCALE*0.5
    };
  }

  // ====== 描画 ======
  function draw(){
    resizeIfNeeded();
    ctx.clearRect(0,0,canvas.width,canvas.height);

    BASE.x = canvas.width/2;
    BASE.y = canvas.height/2;

    ctx.save();
    ctx.translate(BASE.x + cam.x, BASE.y + cam.y);
    ctx.scale(cam.s, cam.s);

    // 背景
    ctx.fillStyle="#070f28";
    ctx.fillRect(-99999,-99999,199998,199998);

    // 地面（雪っぽいタイル）
    ctx.strokeStyle="rgba(255,255,255,.06)";
    for(let y=0;y<=1200;y+=20){
      for(let x=0;x<=1200;x+=20){
        const p=iso(x,y);
        const a=0.08+(((x*37+y*19)%100)/100)*0.12;
        ctx.fillStyle=`rgba(180,220,255,${a})`;
        tile(p.sx,p.sy);
      }
    }

    // 施設は奥→手前にソート
    const list=[...FIXED].sort((a,b)=>(a.x+a.y)-(b.x+b.y));
    for(const b of list){
      const p=iso(b.x,b.y);

      // 影
      ctx.fillStyle="rgba(0,0,0,.35)";
      ctx.beginPath();
      ctx.ellipse(p.sx,p.sy+TILE_H*0.8,TILE_W*0.35,TILE_H*0.35,0,0,Math.PI*2);
      ctx.fill();

      // 本体
      const w=TILE_W*0.9, h=TILE_H*1.4;
      const x=p.sx-w/2, y=p.sy-h;
      roundRect(x,y,w,h,10);

      let fill="#2b7cff";
      if(b.type==="sun") fill="#ff8a1a";
      if(b.type==="fort") fill="#19c37d";
      if(b.type==="fortress") fill="#2b7cff";

      ctx.fillStyle=fill; ctx.fill();
      ctx.strokeStyle="rgba(255,255,255,.28)";
      ctx.lineWidth=2; ctx.stroke();

      if(b.label){
        ctx.fillStyle="#fff";
        ctx.font="bold 12px system-ui";
        ctx.textAlign="center";
        ctx.fillText(b.label,p.sx,y+h/2+4);
      }
    }

    ctx.restore();
  }

  function tile(sx,sy){
    ctx.beginPath();
    ctx.moveTo(sx,sy);
    ctx.lineTo(sx+TILE_W/2,sy+TILE_H/2);
    ctx.lineTo(sx,sy+TILE_H);
    ctx.lineTo(sx-TILE_W/2,sy+TILE_H/2);
    ctx.closePath();
    ctx.fill(); ctx.stroke();
  }

  function roundRect(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  // ====== 操作（パン／ズーム） ======
  let panning=false,last=null;
  canvas.addEventListener('pointerdown',e=>{
    canvas.setPointerCapture(e.pointerId);
    panning=true; last={x:e.clientX,y:e.clientY};
  });
  canvas.addEventListener('pointermove',e=>{
    if(!panning||!last) return;
    cam.x+=e.clientX-last.x;
    cam.y+=e.clientY-last.y;
    last={x:e.clientX,y:e.clientY};
    draw();
  });
  canvas.addEventListener('pointerup',()=>{panning=false;last=null;});
  canvas.addEventListener('wheel',e=>{
    e.preventDefault();
    cam.s=Math.max(0.4,Math.min(2.5,cam.s*Math.exp(-e.deltaY*0.001)));
    draw();
  },{passive:false});

  document.getElementById('reset').onclick=()=>{
    cam.x=0;cam.y=0;cam.s=1; draw();
  };

  function resizeIfNeeded(){
    const w=canvas.clientWidth,h=canvas.clientHeight;
    if(canvas.width!==w*devicePixelRatio||canvas.height!==h*devicePixelRatio){
      canvas.width=Math.floor(w*devicePixelRatio);
      canvas.height=Math.floor(h*devicePixelRatio);
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
  }
  window.addEventListener('resize',draw);

  draw();
})();
</script>
</body>
</html>